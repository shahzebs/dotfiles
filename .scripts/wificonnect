#!/bin/bash

activewifi="$(nmcli device wifi list | awk '/\*/{print $3}')"

function exitifblank {

    if ! [ "$(echo $1)" ]; then
        exit 
    fi
}

function selectwifi {
    selectedwifi="$(nmcli device wifi list | tail -n +2 | sed 's/\*//; s/--//' | awk '{print $2}' | dmenu -l 10 -p "Current WiFi is $activewifi. Select WiFi:")"

    exitifblank $selectedwifi

    status="$(nmcli device wifi connect $selectedwifi)"

    while [[ $status != *"success"* ]]; do
        password="$(echo "" | dmenu -p "Enter password for $selectedwifi or ':q' to return to selection:")"

        exitifblank $password
        
        if [[ $password == ":q" ]]; then
            selectwifi
            break
        fi

        nmcli connection delete $selectedwifi
        status="$(nmcli device wifi connect $selectedwifi password $password)"
    done
}

selectwifi




